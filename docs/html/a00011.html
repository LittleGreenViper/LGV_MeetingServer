<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LGV_MeetingServer: /Users/chrismarshall/Developer/LGV/LGV_MeetingServer/Sources/LGV_MeetingServer.php File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="icon.png"/></td>
  <td id="projectalign">
   <div id="projectname">LGV_MeetingServer
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('a00011.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">LGV_MeetingServer.php File Reference</div></div>
</div><!--header-->
<div class="contents">

<p><a href="a00011_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html">AServiceInteraction</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class gives an abstract interface for service processors.  <a href="a00023.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa708539db35f3694b961934862f9733f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#aa708539db35f3694b961934862f9733f">_get_accurate_distance</a> ( $lat1, $lon1, $lat2, $lon2)</td></tr>
<tr class="memdesc:aa708539db35f3694b961934862f9733f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Uses <a href="https://en.wikipedia.org/wiki/Vincenty%27s_formulae">the Vincenty calculation</a> to determine the distance (in Kilometers) between the two given lat/long pairs (in Degrees).  <br /></td></tr>
<tr class="separator:aa708539db35f3694b961934862f9733f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c5b174635fbb9a153ee8401d907d45b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a5c5b174635fbb9a153ee8401d907d45b">_sort_meetings_by_distance</a> ( $a, $b)</td></tr>
<tr class="separator:a5c5b174635fbb9a153ee8401d907d45b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac2e1daed0d6e005dc26ff07ee35ecc7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#aac2e1daed0d6e005dc26ff07ee35ecc7">_sort_meetings_by_id</a> ( $a, $b)</td></tr>
<tr class="separator:aac2e1daed0d6e005dc26ff07ee35ecc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3de322379d94508a881aca245ac6919a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a3de322379d94508a881aca245ac6919a">_clean_meeting</a> ($meeting)</td></tr>
<tr class="separator:a3de322379d94508a881aca245ac6919a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab569b03538aff77dcf6be95c31fb0447"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#ab569b03538aff77dcf6be95c31fb0447">_location_predicate</a> ( $geo_center_lng, $geo_center_lat, $geo_radius, $predicate=&quot;&quot;, $count_only=false)</td></tr>
<tr class="separator:ab569b03538aff77dcf6be95c31fb0447"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00e7763e4a4054855e7b26ed1a1b6b3f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a00e7763e4a4054855e7b26ed1a1b6b3f">_meta_table_exists</a> ($pdo_instance)</td></tr>
<tr class="separator:a00e7763e4a4054855e7b26ed1a1b6b3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85cc9c49944092a087c82b0124fc93de"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a85cc9c49944092a087c82b0124fc93de">_data_table_exists</a> ($pdo_instance)</td></tr>
<tr class="separator:a85cc9c49944092a087c82b0124fc93de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a899d62edf15238d8b1ee326064fb2871"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a899d62edf15238d8b1ee326064fb2871">_initialize_meta_database</a> ( $pdo_instance)</td></tr>
<tr class="separator:a899d62edf15238d8b1ee326064fb2871"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f0682a1c6673c26c33a7c5669d256b5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a4f0682a1c6673c26c33a7c5669d256b5">_initialize_main_database</a> ( $pdo_instance, $dbTableName)</td></tr>
<tr class="separator:a4f0682a1c6673c26c33a7c5669d256b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a469d06d76d28a0ffb60101f09ee5d9a4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a469d06d76d28a0ffb60101f09ee5d9a4">update_database</a> ( $physical_only=false, $force=false, $separate_virtual=false)</td></tr>
<tr class="separator:a469d06d76d28a0ffb60101f09ee5d9a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68ded32394f22a9d9c6f238c60e5c651"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a68ded32394f22a9d9c6f238c60e5c651">query_database</a> ($geo_center_lng=NULL, $geo_center_lat=NULL, $geo_radius=NULL, $minimum_found=0, $weekdays=[], $start_time=0, $end_time=0, $org_key=NULL, $ids=NULL, $type=0, $page=0, $page_size=-1)</td></tr>
<tr class="separator:a68ded32394f22a9d9c6f238c60e5c651"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d6dd5a0ccbff3f50559cbf613cf8f54"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a4d6dd5a0ccbff3f50559cbf613cf8f54">get_server_info</a> ()</td></tr>
<tr class="separator:a4d6dd5a0ccbff3f50559cbf613cf8f54"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af0c7f28ccc4d9e483f17007aff10b070"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#af0c7f28ccc4d9e483f17007aff10b070">defined</a> ('LGV_DB_CATCHER') or define('LGV_DB_CATCHER'</td></tr>
<tr class="separator:af0c7f28ccc4d9e483f17007aff10b070"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95513464f33ecdb6bd6b6414591f8157"><td class="memItemLeft" align="right" valign="top">const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a95513464f33ecdb6bd6b6414591f8157">__SERVER_VERSION__</a> &quot;1.4.0&quot;</td></tr>
<tr class="separator:a95513464f33ecdb6bd6b6414591f8157"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a3de322379d94508a881aca245ac6919a" name="a3de322379d94508a881aca245ac6919a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3de322379d94508a881aca245ac6919a">&#9670;&#160;</a></span>_clean_meeting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_clean_meeting </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$meeting</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This "scrubs" a meeting array, so that unused fields are removed. It will help to make transmission much faster.</p>
<dl class="section return"><dt>Returns</dt><dd>the "cleaned" meeting Array. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$meeting</td><td>REQUIRED: The meeting to be filtered (an Array). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00164">164</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  165</span>                          {</div>
<div class="line"><span class="lineno">  166</span>    $keys = array_keys($meeting) ;</div>
<div class="line"><span class="lineno">  167</span>    $ret = Array();</div>
<div class="line"><span class="lineno">  168</span>    </div>
<div class="line"><span class="lineno">  169</span>    <span class="comment">// Get rid of &quot;housekeeping&quot; stuff.</span></div>
<div class="line"><span class="lineno">  170</span>    <span class="keywordflow">if</span> ( isset($meeting[<span class="stringliteral">&quot;id&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  171</span>        unset($meeting[<span class="stringliteral">&quot;id&quot;</span>]);</div>
<div class="line"><span class="lineno">  172</span>    }</div>
<div class="line"><span class="lineno">  173</span>    </div>
<div class="line"><span class="lineno">  174</span>    <span class="keywordflow">if</span> ( isset($meeting[<span class="stringliteral">&quot;radius&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  175</span>        unset($meeting[<span class="stringliteral">&quot;radius&quot;</span>]);</div>
<div class="line"><span class="lineno">  176</span>    }</div>
<div class="line"><span class="lineno">  177</span>    </div>
<div class="line"><span class="lineno">  178</span>    <span class="keywordflow">if</span> ( isset($meeting[<span class="stringliteral">&quot;last_modified&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  179</span>        unset($meeting[<span class="stringliteral">&quot;last_modified&quot;</span>]);</div>
<div class="line"><span class="lineno">  180</span>    }</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>    <span class="keywordflow">foreach</span> ($keys as $key) {</div>
<div class="line"><span class="lineno">  183</span>        <span class="keywordflow">if</span> ( !empty($meeting[$key])) {</div>
<div class="line"><span class="lineno">  184</span>            $value = $meeting[$key];</div>
<div class="line"><span class="lineno">  185</span>            <span class="keywordflow">if</span> ( <span class="stringliteral">&quot;formats&quot;</span> == $key || <span class="stringliteral">&quot;virtual_information&quot;</span> == $key || <span class="stringliteral">&quot;physical_address&quot;</span> == $key ) {</div>
<div class="line"><span class="lineno">  186</span>                $value = unserialize($value);</div>
<div class="line"><span class="lineno">  187</span>                <span class="keywordflow">if</span> ( <span class="stringliteral">&quot;physical_address&quot;</span> == $key ) {</div>
<div class="line"><span class="lineno">  188</span>                    <span class="keywordflow">if</span> ( isset($value[<span class="stringliteral">&quot;latitude&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  189</span>                        unset($value[<span class="stringliteral">&quot;latitude&quot;</span>]);</div>
<div class="line"><span class="lineno">  190</span>                    }</div>
<div class="line"><span class="lineno">  191</span>                    <span class="keywordflow">if</span> ( isset($value[<span class="stringliteral">&quot;longitude&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  192</span>                        unset($value[<span class="stringliteral">&quot;longitude&quot;</span>]);</div>
<div class="line"><span class="lineno">  193</span>                    }</div>
<div class="line"><span class="lineno">  194</span>                }</div>
<div class="line"><span class="lineno">  195</span>            }</div>
<div class="line"><span class="lineno">  196</span>        </div>
<div class="line"><span class="lineno">  197</span>            <span class="keywordflow">switch</span> ( $key ) {</div>
<div class="line"><span class="lineno">  198</span>                <span class="keywordflow">case</span> <span class="stringliteral">&quot;name&quot;</span>:</div>
<div class="line"><span class="lineno">  199</span>                <span class="keywordflow">case</span> <span class="stringliteral">&quot;time_zone&quot;</span>:</div>
<div class="line"><span class="lineno">  200</span>                    $value = strval($value);</div>
<div class="line"><span class="lineno">  201</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  202</span>                    </div>
<div class="line"><span class="lineno">  203</span>                <span class="keywordflow">case</span> <span class="stringliteral">&quot;server_id&quot;</span>:</div>
<div class="line"><span class="lineno">  204</span>                <span class="keywordflow">case</span> <span class="stringliteral">&quot;meeting_id&quot;</span>:</div>
<div class="line"><span class="lineno">  205</span>                <span class="keywordflow">case</span> <span class="stringliteral">&quot;weekday&quot;</span>:</div>
<div class="line"><span class="lineno">  206</span>                <span class="keywordflow">case</span> <span class="stringliteral">&quot;duration&quot;</span>:</div>
<div class="line"><span class="lineno">  207</span>                    $value = intval($value);</div>
<div class="line"><span class="lineno">  208</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  209</span>                    </div>
<div class="line"><span class="lineno">  210</span>                <span class="keywordflow">case</span> <span class="stringliteral">&quot;latitude&quot;</span>:</div>
<div class="line"><span class="lineno">  211</span>                <span class="keywordflow">case</span> <span class="stringliteral">&quot;longitude&quot;</span>:</div>
<div class="line"><span class="lineno">  212</span>                    $value = floatval($value);</div>
<div class="line"><span class="lineno">  213</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  214</span>            }</div>
<div class="line"><span class="lineno">  215</span>        </div>
<div class="line"><span class="lineno">  216</span>            $ret[$key] = $value;</div>
<div class="line"><span class="lineno">  217</span>        }</div>
<div class="line"><span class="lineno">  218</span>    }</div>
<div class="line"><span class="lineno">  219</span>    </div>
<div class="line"><span class="lineno">  220</span>    <span class="keywordflow">return</span> $ret;</div>
<div class="line"><span class="lineno">  221</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00011_source.html#l00391">query_database()</a>.</p>

</div>
</div>
<a id="a85cc9c49944092a087c82b0124fc93de" name="a85cc9c49944092a087c82b0124fc93de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85cc9c49944092a087c82b0124fc93de">&#9670;&#160;</a></span>_data_table_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_data_table_exists </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pdo_instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>true, if the data table exists. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$pdo_instance</td><td>REQUIRED: The PDO instance for this transaction. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00293">293</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  294</span>                              {</div>
<div class="line"><span class="lineno">  295</span>    global $config_file_path;</div>
<div class="line"><span class="lineno">  296</span>    include($config_file_path);    <span class="comment">// Config file path is defined in the calling context. This won&#39;t work, without it.</span></div>
<div class="line"><span class="lineno">  297</span> </div>
<div class="line"><span class="lineno">  298</span>    $sql = <span class="stringliteral">&quot;SELECT * FROM information_schema.tables WHERE table_schema=&#39;$_dbName&#39; AND table_name=&#39;$_dbTableName&#39; LIMIT 1;&quot;</span>;</div>
<div class="line"><span class="lineno">  299</span>    </div>
<div class="line"><span class="lineno">  300</span>    $response = $pdo_instance-&gt;preparedStatement($sql, [], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>    <span class="keywordflow">return</span> !empty($response);</div>
<div class="line"><span class="lineno">  303</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00011_source.html#l00391">query_database()</a>, and <a class="el" href="a00011_source.html#l00356">update_database()</a>.</p>

</div>
</div>
<a id="aa708539db35f3694b961934862f9733f" name="aa708539db35f3694b961934862f9733f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa708539db35f3694b961934862f9733f">&#9670;&#160;</a></span>_get_accurate_distance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_get_accurate_distance </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lat1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lon1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lat2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lon2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Uses <a href="https://en.wikipedia.org/wiki/Vincenty%27s_formulae">the Vincenty calculation</a> to determine the distance (in Kilometers) between the two given lat/long pairs (in Degrees). </p>
<p>The Vincenty calculation is more accurate than the Haversine calculation, as it takes into account the "un-spherical" shape of the Earth, but is more computationally intense. We use this calculation to refine the Haversine "triage" in SQL.</p>
<dl class="section return"><dt>Returns</dt><dd>a Float with the distance, in Kilometers. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$lat1</td><td>This is the first point latitude (degrees).  </td></tr>
    <tr><td class="paramname">$lon1</td><td>This is the first point longitude (degrees).  </td></tr>
    <tr><td class="paramname">$lat2</td><td>This is the second point latitude (degrees).  </td></tr>
    <tr><td class="paramname">$lon2</td><td>This is the second point longitude (degrees). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00049">49</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   54</span>{</div>
<div class="line"><span class="lineno">   55</span>    <span class="keywordflow">if</span> (($lat1 == $lat2) &amp;&amp; ($lon1 == $lon2)) { <span class="comment">// Just a quick shortcut.</span></div>
<div class="line"><span class="lineno">   56</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   57</span>    }</div>
<div class="line"><span class="lineno">   58</span>    </div>
<div class="line"><span class="lineno">   59</span>    $a = 6378137;</div>
<div class="line"><span class="lineno">   60</span>    $b = 6356752.3142;</div>
<div class="line"><span class="lineno">   61</span>    $f = 1/298.257223563;  <span class="comment">// WGS-84 ellipsiod</span></div>
<div class="line"><span class="lineno">   62</span>    $L = ($lon2-$lon1)/57.2957795131;</div>
<div class="line"><span class="lineno">   63</span>    $U1 = atan((1.0-$f) * tan($lat1/57.2957795131));</div>
<div class="line"><span class="lineno">   64</span>    $U2 = atan((1.0-$f) * tan($lat2/57.2957795131));</div>
<div class="line"><span class="lineno">   65</span>    $sinU1 = sin($U1);</div>
<div class="line"><span class="lineno">   66</span>    $cosU1 = cos($U1);</div>
<div class="line"><span class="lineno">   67</span>    $sinU2 = sin($U2);</div>
<div class="line"><span class="lineno">   68</span>    $cosU2 = cos($U2);</div>
<div class="line"><span class="lineno">   69</span>      </div>
<div class="line"><span class="lineno">   70</span>    $lambda = $L;</div>
<div class="line"><span class="lineno">   71</span>    $lambdaP = $L;</div>
<div class="line"><span class="lineno">   72</span>    $iterLimit = 100;</div>
<div class="line"><span class="lineno">   73</span>    </div>
<div class="line"><span class="lineno">   74</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">   75</span>        $sinLambda = sin($lambda);</div>
<div class="line"><span class="lineno">   76</span>        $cosLambda = cos($lambda);</div>
<div class="line"><span class="lineno">   77</span>        $sinSigma = sqrt(($cosU2*$sinLambda) * ($cosU2*$sinLambda) + ($cosU1*$sinU2-$sinU1*$cosU2*$cosLambda) * ($cosU1*$sinU2-$sinU1*$cosU2*$cosLambda));</div>
<div class="line"><span class="lineno">   78</span>        <span class="keywordflow">if</span> ($sinSigma==0) {</div>
<div class="line"><span class="lineno">   79</span>            <span class="keywordflow">return</span> 0;  <span class="comment">// co-incident points</span></div>
<div class="line"><span class="lineno">   80</span>        }</div>
<div class="line"><span class="lineno">   81</span>        </div>
<div class="line"><span class="lineno">   82</span>        $cosSigma = $sinU1*$sinU2 + ($cosU1*$cosU2*$cosLambda);</div>
<div class="line"><span class="lineno">   83</span>        $sigma = atan2($sinSigma, $cosSigma);</div>
<div class="line"><span class="lineno">   84</span>        $sinAlpha = ($cosU1 * $cosU2 * $sinLambda) / $sinSigma;</div>
<div class="line"><span class="lineno">   85</span>        $cosSqAlpha = 1.0 - $sinAlpha*$sinAlpha;</div>
<div class="line"><span class="lineno">   86</span>        </div>
<div class="line"><span class="lineno">   87</span>        <span class="keywordflow">if</span> (0 == $cosSqAlpha) {</div>
<div class="line"><span class="lineno">   88</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   89</span>        }</div>
<div class="line"><span class="lineno">   90</span>        </div>
<div class="line"><span class="lineno">   91</span>        $cos2SigmaM = $cosSigma - 2.0*$sinU1*$sinU2/$cosSqAlpha;</div>
<div class="line"><span class="lineno">   92</span>        </div>
<div class="line"><span class="lineno">   93</span>        $divisor = (16.0*$cosSqAlpha*(4.0+$f*(4.0-3.0*$cosSqAlpha)));</div>
<div class="line"><span class="lineno">   94</span>        </div>
<div class="line"><span class="lineno">   95</span>        <span class="keywordflow">if</span> (0 == $divisor) {</div>
<div class="line"><span class="lineno">   96</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   97</span>        }</div>
<div class="line"><span class="lineno">   98</span>        </div>
<div class="line"><span class="lineno">   99</span>        $C = $f/$divisor;</div>
<div class="line"><span class="lineno">  100</span>        </div>
<div class="line"><span class="lineno">  101</span>        $lambdaP = $lambda;</div>
<div class="line"><span class="lineno">  102</span>        $lambda = $L + (1.0-$C) * $f * $sinAlpha * ($sigma + $C*$sinSigma*($cos2SigmaM+$C*$cosSigma*(-1.0+2.0*$cos2SigmaM*$cos2SigmaM)));</div>
<div class="line"><span class="lineno">  103</span>    } <span class="keywordflow">while</span> (abs($lambda-$lambdaP) &gt; 1e-12 &amp;&amp; --$iterLimit&gt;0);</div>
<div class="line"><span class="lineno">  104</span> </div>
<div class="line"><span class="lineno">  105</span>    $uSq = $cosSqAlpha * ($a*$a - $b*$b) / ($b*$b);</div>
<div class="line"><span class="lineno">  106</span>    $A = 1.0 + $uSq/16384.0*(4096.0+$uSq*(-768.0+$uSq*(320.0-175.0*$uSq)));</div>
<div class="line"><span class="lineno">  107</span>    $B = $uSq/1024.0 * (256.0+$uSq*(-128.0+$uSq*(74.0-47.0*$uSq)));</div>
<div class="line"><span class="lineno">  108</span>    $deltaSigma = $B*$sinSigma*($cos2SigmaM+$B/4.0*($cosSigma*(-1.0+2.0*$cos2SigmaM*$cos2SigmaM)-$B/6.0*$cos2SigmaM*(-3.0+4.0*$sinSigma*$sinSigma)*(-3.0+4.0*$cos2SigmaM*$cos2SigmaM)));</div>
<div class="line"><span class="lineno">  109</span>    $s = $b*$A*($sigma-$deltaSigma);</div>
<div class="line"><span class="lineno">  110</span>    </div>
<div class="line"><span class="lineno">  111</span>    <span class="keywordflow">return</span> ( abs ( round ( $s ) / 1000.0 ) ); </div>
<div class="line"><span class="lineno">  112</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00011_source.html#l00391">query_database()</a>.</p>

</div>
</div>
<a id="a4f0682a1c6673c26c33a7c5669d256b5" name="a4f0682a1c6673c26c33a7c5669d256b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f0682a1c6673c26c33a7c5669d256b5">&#9670;&#160;</a></span>_initialize_main_database()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_initialize_main_database </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pdo_instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$dbTableName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>true, if successful. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$pdo_instance</td><td>REQUIRED: The PDO instance for this transaction.  </td></tr>
    <tr><td class="paramname">$dbTableName</td><td>REQUIRED: The name of the table to receive the initialization </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00329">329</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  331</span>                                  {</div>
<div class="line"><span class="lineno">  332</span>    $sql_init = file_get_contents(dirname(__FILE__).<span class="stringliteral">&#39;/config/sql/LGV_MeetingServer-MySQL.sql&#39;</span>);</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  335</span>        $sql_init = str_replace(<span class="stringliteral">&quot;`TABLE-NAME`&quot;</span>, <span class="stringliteral">&quot;`$dbTableName`&quot;</span>, $sql_init);</div>
<div class="line"><span class="lineno">  336</span>        $pdo_instance-&gt;preparedStatement($sql_init);</div>
<div class="line"><span class="lineno">  337</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  338</span>    } <span class="keywordflow">catch</span> (Exception $exception) {</div>
<div class="line"><span class="lineno">  339</span>    }</div>
<div class="line"><span class="lineno">  340</span>    </div>
<div class="line"><span class="lineno">  341</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  342</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00011_source.html#l00356">update_database()</a>.</p>

</div>
</div>
<a id="a899d62edf15238d8b1ee326064fb2871" name="a899d62edf15238d8b1ee326064fb2871"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a899d62edf15238d8b1ee326064fb2871">&#9670;&#160;</a></span>_initialize_meta_database()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_initialize_meta_database </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pdo_instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>true, if successful. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$pdo_instance</td><td>REQUIRED: The PDO instance for this transaction. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00309">309</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  310</span>                                  {</div>
<div class="line"><span class="lineno">  311</span>    global $config_file_path;</div>
<div class="line"><span class="lineno">  312</span>    include($config_file_path);    <span class="comment">// Config file path is defined in the calling context. This won&#39;t work, without it.</span></div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>    $sql_init = file_get_contents(dirname(__FILE__).<span class="stringliteral">&#39;/config/sql/LGV_MeetingServer-Meta-MySQL.sql&#39;</span>) . <span class="stringliteral">&quot;;DROP TABLE IF EXISTS `$_dbTableName`;DROP TABLE IF EXISTS `$_dbTempTableName`&quot;</span>;;</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  317</span>        $pdo_instance-&gt;preparedStatement($sql_init);</div>
<div class="line"><span class="lineno">  318</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  319</span>    } <span class="keywordflow">catch</span> (Exception $exception) {</div>
<div class="line"><span class="lineno">  320</span>    }</div>
<div class="line"><span class="lineno">  321</span>    </div>
<div class="line"><span class="lineno">  322</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  323</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00011_source.html#l00356">update_database()</a>.</p>

</div>
</div>
<a id="ab569b03538aff77dcf6be95c31fb0447" name="ab569b03538aff77dcf6be95c31fb0447"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab569b03538aff77dcf6be95c31fb0447">&#9670;&#160;</a></span>_location_predicate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_location_predicate </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$geo_center_lng</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$geo_center_lat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$geo_radius</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$predicate</em> = <code>&quot;&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$count_only</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This method creates a special SQL header that has an embedded <a href="https://en.wikipedia.org/wiki/Haversine_formula">Haversine formula</a>.</p>
<p>The Haversine formula is not as accurate as the Vincenty Calculation, but is a lot less computationally intense, so we use this in SQL for a "triage."</p>
<dl class="section return"><dt>Returns</dt><dd>an SQL query that will specify a Haversine search. It will include any given WHERE predicate. This adds no placeholders to the predicate. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$geo_center_lng</td><td>REQUIRED FLOAT: The search center longitude, in degrees.  </td></tr>
    <tr><td class="paramname">$geo_center_lat</td><td>REQUIRED FLOAT: The search center latitude, in degrees.  </td></tr>
    <tr><td class="paramname">$geo_radius</td><td>REQUIRED FLOAT: The search radius, in Kilometers.  </td></tr>
    <tr><td class="paramname">$predicate</td><td>OPTIONAL STRING: A WHERE predicate to be anded to the location predicate. Default is empty string. WARNING: Possible security issue! Make sure it's parameterized (or otherwise cleaned)!  </td></tr>
    <tr><td class="paramname">$count_only</td><td>OPTIONAL BOOLEAN: If true (default is false), then only a single integer will be returned, with the count of items that fit the search. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00231">231</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  236</span>                              {</div>
<div class="line"><span class="lineno">  237</span>    <span class="keywordflow">if</span> ( $predicate ) {</div>
<div class="line"><span class="lineno">  238</span>        $predicate = <span class="stringliteral">&quot;($predicate) AND&quot;</span>;</div>
<div class="line"><span class="lineno">  239</span>    }</div>
<div class="line"><span class="lineno">  240</span>    </div>
<div class="line"><span class="lineno">  241</span>    global $config_file_path;</div>
<div class="line"><span class="lineno">  242</span>    include($config_file_path);    <span class="comment">// Config file path is defined in the calling context. This won&#39;t work, without it.</span></div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>    $ret =  <span class="stringliteral">&quot;SELECT * FROM (</span></div>
<div class="line"><span class="lineno">  245</span><span class="stringliteral">                SELECT z.*,</span></div>
<div class="line"><span class="lineno">  246</span><span class="stringliteral">                    p.radius,</span></div>
<div class="line"><span class="lineno">  247</span><span class="stringliteral">                    p.distance_unit</span></div>
<div class="line"><span class="lineno">  248</span><span class="stringliteral">                             * DEGREES(ACOS(COS(RADIANS(p.latpoint))</span></div>
<div class="line"><span class="lineno">  249</span><span class="stringliteral">                             * COS(RADIANS(z.latitude))</span></div>
<div class="line"><span class="lineno">  250</span><span class="stringliteral">                             * COS(RADIANS(p.longpoint - z.longitude))</span></div>
<div class="line"><span class="lineno">  251</span><span class="stringliteral">                             + SIN(RADIANS(p.latpoint))</span></div>
<div class="line"><span class="lineno">  252</span><span class="stringliteral">                             * SIN(RADIANS(z.latitude)))) AS distance</span></div>
<div class="line"><span class="lineno">  253</span><span class="stringliteral">                FROM `&quot;</span>.$_dbTableName.<span class="stringliteral">&quot;` AS z</span></div>
<div class="line"><span class="lineno">  254</span><span class="stringliteral">                JOIN (   /* these are the query parameters */</span></div>
<div class="line"><span class="lineno">  255</span><span class="stringliteral">                    SELECT  &quot;</span>.floatval($geo_center_lat).<span class="stringliteral">&quot; AS latpoint, &quot;</span>.floatval($geo_center_lng).<span class="stringliteral">&quot; AS longpoint,&quot;</span>.floatval($geo_radius).<span class="stringliteral">&quot; AS radius, 111.045 AS distance_unit</span></div>
<div class="line"><span class="lineno">  256</span><span class="stringliteral">                ) AS p ON 1=1</span></div>
<div class="line"><span class="lineno">  257</span><span class="stringliteral">                WHERE z.latitude</span></div>
<div class="line"><span class="lineno">  258</span><span class="stringliteral">                 BETWEEN p.latpoint  - (p.radius / p.distance_unit)</span></div>
<div class="line"><span class="lineno">  259</span><span class="stringliteral">                     AND p.latpoint  + (p.radius / p.distance_unit)</span></div>
<div class="line"><span class="lineno">  260</span><span class="stringliteral">                AND z.longitude</span></div>
<div class="line"><span class="lineno">  261</span><span class="stringliteral">                 BETWEEN p.longpoint - (p.radius / (p.distance_unit * COS(RADIANS(p.latpoint))))</span></div>
<div class="line"><span class="lineno">  262</span><span class="stringliteral">                     AND p.longpoint + (p.radius / (p.distance_unit * COS(RADIANS(p.latpoint))))</span></div>
<div class="line"><span class="lineno">  263</span><span class="stringliteral">                ) AS d</span></div>
<div class="line"><span class="lineno">  264</span><span class="stringliteral">                WHERE $predicate (distance &lt;= radius)&quot;</span>;</div>
<div class="line"><span class="lineno">  265</span>    </div>
<div class="line"><span class="lineno">  266</span>    <span class="keywordflow">if</span> ( $count_only ) {</div>
<div class="line"><span class="lineno">  267</span>        $ret = <span class="stringliteral">&quot;SELECT COUNT(*) FROM ($ret)&quot;</span>;</div>
<div class="line"><span class="lineno">  268</span>    }</div>
<div class="line"><span class="lineno">  269</span>    </div>
<div class="line"><span class="lineno">  270</span>    <span class="keywordflow">return</span> $ret;</div>
<div class="line"><span class="lineno">  271</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00011_source.html#l00391">query_database()</a>.</p>

</div>
</div>
<a id="a00e7763e4a4054855e7b26ed1a1b6b3f" name="a00e7763e4a4054855e7b26ed1a1b6b3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00e7763e4a4054855e7b26ed1a1b6b3f">&#9670;&#160;</a></span>_meta_table_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_meta_table_exists </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pdo_instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>true, if the meta table exists. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$pdo_instance</td><td>REQUIRED: The PDO instance for this transaction. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00277">277</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  278</span>                              {</div>
<div class="line"><span class="lineno">  279</span>    global $config_file_path;</div>
<div class="line"><span class="lineno">  280</span>    include($config_file_path);    <span class="comment">// Config file path is defined in the calling context. This won&#39;t work, without it.</span></div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>    $sql = <span class="stringliteral">&quot;SELECT * FROM information_schema.tables WHERE table_schema=&#39;$_dbName&#39; AND table_name=&#39;$_dbMetaTableName&#39; LIMIT 1;&quot;</span>;</div>
<div class="line"><span class="lineno">  283</span>    </div>
<div class="line"><span class="lineno">  284</span>    $response = $pdo_instance-&gt;preparedStatement($sql, [], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>    <span class="keywordflow">return</span> !empty($response);</div>
<div class="line"><span class="lineno">  287</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00011_source.html#l00356">update_database()</a>.</p>

</div>
</div>
<a id="a5c5b174635fbb9a153ee8401d907d45b" name="a5c5b174635fbb9a153ee8401d907d45b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c5b174635fbb9a153ee8401d907d45b">&#9670;&#160;</a></span>_sort_meetings_by_distance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_sort_meetings_by_distance </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is a simple sort closure, for the resultant meeting array. We sort on the distances from search center. This allows us to maintain a consistent order to each server's meetings.</p>
<dl class="section return"><dt>Returns</dt><dd>0, if the IDs are equal, or -1 is $a is less than $b, or 1, otherwise. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$a</td><td>REQUIRED: The first meeting to check.  </td></tr>
    <tr><td class="paramname">$b</td><td>REQUIRED: The second meeting to check. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00121">121</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  123</span>                                      {</div>
<div class="line"><span class="lineno">  124</span>    $aVal = floatval($a[<span class="stringliteral">&quot;distance&quot;</span>]);</div>
<div class="line"><span class="lineno">  125</span>    $bVal = floatval($b[<span class="stringliteral">&quot;distance&quot;</span>]);</div>
<div class="line"><span class="lineno">  126</span>    </div>
<div class="line"><span class="lineno">  127</span>    <span class="keywordflow">return</span> ($aVal == $bVal) ? <a class="code hl_function" href="a00011.html#aac2e1daed0d6e005dc26ff07ee35ecc7">_sort_meetings_by_id</a>($a, $b) : (($aVal &lt; $bVal) ? -1 : 1);</div>
<div class="line"><span class="lineno">  128</span>}</div>
<div class="ttc" id="aa00011_html_aac2e1daed0d6e005dc26ff07ee35ecc7"><div class="ttname"><a href="a00011.html#aac2e1daed0d6e005dc26ff07ee35ecc7">_sort_meetings_by_id</a></div><div class="ttdeci">_sort_meetings_by_id( $a, $b)</div><div class="ttdef"><b>Definition</b> <a href="a00011_source.html#l00137">LGV_MeetingServer.php:137</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00011_source.html#l00137">_sort_meetings_by_id()</a>.</p>

</div>
</div>
<a id="aac2e1daed0d6e005dc26ff07ee35ecc7" name="aac2e1daed0d6e005dc26ff07ee35ecc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac2e1daed0d6e005dc26ff07ee35ecc7">&#9670;&#160;</a></span>_sort_meetings_by_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_sort_meetings_by_id </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is a simple sort closure, for the resultant meeting array. We sort on the IDs of the servers and meetings. This allows us to maintain a consistent order to each server's meetings.</p>
<dl class="section return"><dt>Returns</dt><dd>0, if the IDs are equal, or -1 is $a is less than $b, or 1, otherwise. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$a</td><td>REQUIRED: The first meeting to check.  </td></tr>
    <tr><td class="paramname">$b</td><td>REQUIRED: The second meeting to check. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00137">137</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  139</span>                              {</div>
<div class="line"><span class="lineno">  140</span>    $aVal_server = intval($a[<span class="stringliteral">&quot;server_id&quot;</span>]);</div>
<div class="line"><span class="lineno">  141</span>    $bVal_server = intval($b[<span class="stringliteral">&quot;server_id&quot;</span>]);</div>
<div class="line"><span class="lineno">  142</span>    </div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">if</span> ($aVal_server == $bVal_server) {</div>
<div class="line"><span class="lineno">  144</span>        $aVal_meeting = intval($a[<span class="stringliteral">&quot;meeting_id&quot;</span>]);</div>
<div class="line"><span class="lineno">  145</span>        $bVal_meeting = intval($b[<span class="stringliteral">&quot;meeting_id&quot;</span>]);</div>
<div class="line"><span class="lineno">  146</span>        </div>
<div class="line"><span class="lineno">  147</span>        <span class="keywordflow">if</span> ( $aVal_meeting == $bVal_meeting ) {</div>
<div class="line"><span class="lineno">  148</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  149</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  150</span>            <span class="keywordflow">return</span> ($aVal_meeting &lt; $bVal_meeting) ? -1 : 1;</div>
<div class="line"><span class="lineno">  151</span>        }</div>
<div class="line"><span class="lineno">  152</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  153</span>        <span class="keywordflow">return</span> ($aVal_server &lt; $bVal_server) ? -1 : 1;</div>
<div class="line"><span class="lineno">  154</span>    }</div>
<div class="line"><span class="lineno">  155</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="a00011_source.html#l00121">_sort_meetings_by_distance()</a>.</p>

</div>
</div>
<a id="a4d6dd5a0ccbff3f50559cbf613cf8f54" name="a4d6dd5a0ccbff3f50559cbf613cf8f54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d6dd5a0ccbff3f50559cbf613cf8f54">&#9670;&#160;</a></span>get_server_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_server_info </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>a JSON object, with the server information. </dd></dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00644">644</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  644</span>                           {</div>
<div class="line"><span class="lineno">  645</span>    $ret = [<span class="stringliteral">&quot;server_version&quot;</span> =&gt; <a class="code hl_variable" href="a00011.html#a95513464f33ecdb6bd6b6414591f8157">__SERVER_VERSION__</a>];</div>
<div class="line"><span class="lineno">  646</span>    </div>
<div class="line"><span class="lineno">  647</span>    global $config_file_path;</div>
<div class="line"><span class="lineno">  648</span>    include($config_file_path);    <span class="comment">// Config file path is defined in the calling context. This won&#39;t work, without it.</span></div>
<div class="line"><span class="lineno">  649</span>    </div>
<div class="line"><span class="lineno">  650</span>    $pdo_instance = <span class="keyword">new</span> <a class="code hl_class" href="a00031.html">LGV_MeetingServer_PDO</a>($_dbName, $_dbLogin, $_dbPassword, $_dbType, $_dbHost, $_dbPort);</div>
<div class="line"><span class="lineno">  651</span> </div>
<div class="line"><span class="lineno">  652</span>    $sql = <span class="stringliteral">&quot;SELECT `last_update` FROM `&quot;</span>.$_dbMetaTableName.<span class="stringliteral">&quot;` WHERE 1&quot;</span>;</div>
<div class="line"><span class="lineno">  653</span>    $response = $pdo_instance-&gt;preparedStatement($sql, [], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  654</span>    </div>
<div class="line"><span class="lineno">  655</span>    <span class="keywordflow">if</span> ( !empty($response) &amp;&amp; !empty($response[0][<span class="stringliteral">&quot;last_update&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  656</span>        $last_update = intval($response[0][<span class="stringliteral">&quot;last_update&quot;</span>]);</div>
<div class="line"><span class="lineno">  657</span>        $ret[<span class="stringliteral">&quot;last_update_timestamp&quot;</span>] = $last_update;</div>
<div class="line"><span class="lineno">  658</span>    }</div>
<div class="line"><span class="lineno">  659</span>        </div>
<div class="line"><span class="lineno">  660</span>    $total_meetings = 0;</div>
<div class="line"><span class="lineno">  661</span>    </div>
<div class="line"><span class="lineno">  662</span>    $sql = <span class="stringliteral">&quot;SELECT COUNT(*) FROM (SELECT * FROM `&quot;</span>.$_dbTableName.<span class="stringliteral">&quot;` WHERE 1) AS C&quot;</span>;</div>
<div class="line"><span class="lineno">  663</span>    $response = $pdo_instance-&gt;preparedStatement($sql, [], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  664</span>    </div>
<div class="line"><span class="lineno">  665</span>    <span class="keywordflow">if</span> ( isset($response[0][<span class="stringliteral">&quot;count(*)&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  666</span>        $total_meetings = intval($response[0][<span class="stringliteral">&quot;count(*)&quot;</span>]);</div>
<div class="line"><span class="lineno">  667</span>    }</div>
<div class="line"><span class="lineno">  668</span> </div>
<div class="line"><span class="lineno">  669</span>    $sql = <span class="stringliteral">&quot;SELECT DISTINCT `organization_key` FROM `&quot;</span>.$_dbTableName.<span class="stringliteral">&quot;` WHERE 1 ORDER BY `organization_key`&quot;</span>;</div>
<div class="line"><span class="lineno">  670</span>    $response = $pdo_instance-&gt;preparedStatement($sql, [], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  671</span>    </div>
<div class="line"><span class="lineno">  672</span>    <span class="keywordflow">if</span> ( !empty($response) &amp;&amp; is_array($response) ) {</div>
<div class="line"><span class="lineno">  673</span>        $organizations = [<span class="stringliteral">&quot;total_meetings&quot;</span> =&gt; $total_meetings];</div>
<div class="line"><span class="lineno">  674</span>        <span class="keywordflow">foreach</span> ( $response as $organization_ar ) {</div>
<div class="line"><span class="lineno">  675</span>            <span class="keywordflow">if</span> ( !empty($organization_ar) &amp;&amp; !empty($organization_ar[<span class="stringliteral">&quot;organization_key&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  676</span>                $sql = <span class="stringliteral">&quot;SELECT COUNT(*) FROM (SELECT `id` FROM `&quot;</span>.$_dbTableName.<span class="stringliteral">&quot;` WHERE `organization_key`=?) AS C&quot;</span>;</div>
<div class="line"><span class="lineno">  677</span>                $res_temp = $pdo_instance-&gt;preparedStatement($sql, [$organization_ar[<span class="stringliteral">&quot;organization_key&quot;</span>]], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  678</span>                $num_meetings = 0;</div>
<div class="line"><span class="lineno">  679</span>                <span class="keywordflow">if</span> ( isset($res_temp[0][<span class="stringliteral">&quot;count(*)&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  680</span>                    $num_meetings = intval($res_temp[0][<span class="stringliteral">&quot;count(*)&quot;</span>]);</div>
<div class="line"><span class="lineno">  681</span>                }</div>
<div class="line"><span class="lineno">  682</span>                $organizations[$organization_ar[<span class="stringliteral">&quot;organization_key&quot;</span>]] = $num_meetings;</div>
<div class="line"><span class="lineno">  683</span>            }</div>
<div class="line"><span class="lineno">  684</span>        }</div>
<div class="line"><span class="lineno">  685</span>        </div>
<div class="line"><span class="lineno">  686</span>        arsort($organizations);</div>
<div class="line"><span class="lineno">  687</span>        $ret[<span class="stringliteral">&quot;organizations&quot;</span>] = $organizations;</div>
<div class="line"><span class="lineno">  688</span>    }</div>
<div class="line"><span class="lineno">  689</span> </div>
<div class="line"><span class="lineno">  690</span>    $sql = <span class="stringliteral">&quot;SELECT DISTINCT `server_id` FROM `&quot;</span>.$_dbTableName.<span class="stringliteral">&quot;` WHERE 1&quot;</span>;</div>
<div class="line"><span class="lineno">  691</span>    $response = $pdo_instance-&gt;preparedStatement($sql, [], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  692</span>    </div>
<div class="line"><span class="lineno">  693</span>    <span class="keywordflow">if</span> ( !empty($response) &amp;&amp; is_array($response) ) {</div>
<div class="line"><span class="lineno">  694</span>        $server_ids = [];</div>
<div class="line"><span class="lineno">  695</span>        </div>
<div class="line"><span class="lineno">  696</span>        <span class="keywordflow">foreach</span> ( $response as $server_id_ar ) {</div>
<div class="line"><span class="lineno">  697</span>            <span class="keywordflow">if</span> ( !empty($server_id_ar) &amp;&amp; (0 &lt; intval($server_id_ar[<span class="stringliteral">&#39;server_id&#39;</span>])) ) {</div>
<div class="line"><span class="lineno">  698</span>                array_push($server_ids, intval($server_id_ar[<span class="stringliteral">&#39;server_id&#39;</span>]) );</div>
<div class="line"><span class="lineno">  699</span>            }</div>
<div class="line"><span class="lineno">  700</span>        }</div>
<div class="line"><span class="lineno">  701</span>        </div>
<div class="line"><span class="lineno">  702</span>        $server_ids = array_unique($server_ids);</div>
<div class="line"><span class="lineno">  703</span>        asort($server_ids);</div>
<div class="line"><span class="lineno">  704</span>        $ret[<span class="stringliteral">&quot;server_ids&quot;</span>] = $server_ids;</div>
<div class="line"><span class="lineno">  705</span>    }</div>
<div class="line"><span class="lineno">  706</span> </div>
<div class="line"><span class="lineno">  707</span>    $services = [<span class="keyword">new</span> <a class="code hl_class" href="a00027.html">BMLTServerInteraction</a>()];</div>
<div class="line"><span class="lineno">  708</span>    </div>
<div class="line"><span class="lineno">  709</span>    $services_response = [];</div>
<div class="line"><span class="lineno">  710</span>    <span class="keywordflow">foreach</span> ( $services as $service ) {</div>
<div class="line"><span class="lineno">  711</span>        $info = $service-&gt;service_info();</div>
<div class="line"><span class="lineno">  712</span>        $service_name = $info[<span class="stringliteral">&quot;service_name&quot;</span>];</div>
<div class="line"><span class="lineno">  713</span>        </div>
<div class="line"><span class="lineno">  714</span>        <span class="keywordflow">if</span> ( !empty($info) ) {</div>
<div class="line"><span class="lineno">  715</span>            <span class="keywordflow">if</span> ( !empty($info[<span class="stringliteral">&quot;servers&quot;</span>]) &amp;&amp; is_array($info[<span class="stringliteral">&quot;servers&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  716</span>                $servers = $info[<span class="stringliteral">&quot;servers&quot;</span>];</div>
<div class="line"><span class="lineno">  717</span>                <span class="keywordflow">foreach</span> ( $servers as $key =&gt; $value ) {</div>
<div class="line"><span class="lineno">  718</span>                    <span class="keywordflow">if</span> ( 0 &lt; intval($key) ) {</div>
<div class="line"><span class="lineno">  719</span>                        $orgs = array();</div>
<div class="line"><span class="lineno">  720</span>                        $server_id = intval($key);</div>
<div class="line"><span class="lineno">  721</span>                        $num_meetings = 0;</div>
<div class="line"><span class="lineno">  722</span> </div>
<div class="line"><span class="lineno">  723</span>                        $sql = <span class="stringliteral">&quot;SELECT COUNT(*) FROM (SELECT `id` FROM `&quot;</span>.$_dbTableName.<span class="stringliteral">&quot;` WHERE `server_id`=$server_id) AS C&quot;</span>;</div>
<div class="line"><span class="lineno">  724</span>                        $res_temp = $pdo_instance-&gt;preparedStatement($sql, [], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  725</span>                        <span class="keywordflow">if</span> ( isset($res_temp[0][<span class="stringliteral">&quot;count(*)&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  726</span>                            $num_meetings = intval($res_temp[0][<span class="stringliteral">&quot;count(*)&quot;</span>]);</div>
<div class="line"><span class="lineno">  727</span>                            $info[<span class="stringliteral">&quot;servers&quot;</span>][$server_id][<span class="stringliteral">&quot;num_meetings&quot;</span>] = $num_meetings;</div>
<div class="line"><span class="lineno">  728</span>                        }</div>
<div class="line"><span class="lineno">  729</span>                        </div>
<div class="line"><span class="lineno">  730</span>                        $sql = <span class="stringliteral">&quot;SELECT DISTINCT `organization_key` FROM `&quot;</span>.$_dbTableName.<span class="stringliteral">&quot;` WHERE `server_id`=$server_id ORDER BY `organization_key`&quot;</span>;</div>
<div class="line"><span class="lineno">  731</span>                        $response = $pdo_instance-&gt;preparedStatement($sql, [], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  732</span>                        <span class="keywordflow">if</span> ( !empty($response) &amp;&amp; is_array($response) ) {</div>
<div class="line"><span class="lineno">  733</span>                            <span class="keywordflow">foreach</span> ( $response as $org ) {</div>
<div class="line"><span class="lineno">  734</span>                                <span class="keywordflow">if</span> ( !empty($org[<span class="stringliteral">&quot;organization_key&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  735</span>                                    $org_key = $org[<span class="stringliteral">&quot;organization_key&quot;</span>];</div>
<div class="line"><span class="lineno">  736</span>                                    $sql = <span class="stringliteral">&quot;SELECT COUNT(*) FROM (SELECT `id` FROM `&quot;</span>.$_dbTableName.<span class="stringliteral">&quot;` WHERE `organization_key`=? AND `server_id`=?) AS C&quot;</span>;</div>
<div class="line"><span class="lineno">  737</span>                                    $res_temp_2 = $pdo_instance-&gt;preparedStatement($sql, [$org_key, $server_id], <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  738</span>                                    $num_meetings = 0;</div>
<div class="line"><span class="lineno">  739</span>                                    <span class="keywordflow">if</span> ( isset($res_temp_2[0][<span class="stringliteral">&quot;count(*)&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  740</span>                                        $num_meetings = intval($res_temp_2[0][<span class="stringliteral">&quot;count(*)&quot;</span>]);</div>
<div class="line"><span class="lineno">  741</span>                                    }</div>
<div class="line"><span class="lineno">  742</span>                                    $orgs[$org_key] = $num_meetings;</div>
<div class="line"><span class="lineno">  743</span>                                }</div>
<div class="line"><span class="lineno">  744</span>                            }</div>
<div class="line"><span class="lineno">  745</span>                            </div>
<div class="line"><span class="lineno">  746</span>                            <span class="keywordflow">if</span> ( !empty($orgs) ) {</div>
<div class="line"><span class="lineno">  747</span>                                $info[<span class="stringliteral">&quot;servers&quot;</span>][$server_id][<span class="stringliteral">&quot;organizations&quot;</span>] = $orgs;</div>
<div class="line"><span class="lineno">  748</span>                            }</div>
<div class="line"><span class="lineno">  749</span>                        }</div>
<div class="line"><span class="lineno">  750</span>                    }</div>
<div class="line"><span class="lineno">  751</span>                }</div>
<div class="line"><span class="lineno">  752</span>            }</div>
<div class="line"><span class="lineno">  753</span>            </div>
<div class="line"><span class="lineno">  754</span>            $services_response[$service_name] = $info;</div>
<div class="line"><span class="lineno">  755</span>        }</div>
<div class="line"><span class="lineno">  756</span>    }</div>
<div class="line"><span class="lineno">  757</span> </div>
<div class="line"><span class="lineno">  758</span>    $ret[<span class="stringliteral">&quot;services&quot;</span>] = $services_response;</div>
<div class="line"><span class="lineno">  759</span> </div>
<div class="line"><span class="lineno">  760</span>    <span class="keywordflow">return</span> json_encode($ret);</div>
<div class="line"><span class="lineno">  761</span>}</div>
<div class="ttc" id="aa00011_html_a95513464f33ecdb6bd6b6414591f8157"><div class="ttname"><a href="a00011.html#a95513464f33ecdb6bd6b6414591f8157">__SERVER_VERSION__</a></div><div class="ttdeci">const __SERVER_VERSION__</div><div class="ttdef"><b>Definition</b> <a href="a00011_source.html#l00036">LGV_MeetingServer.php:36</a></div></div>
<div class="ttc" id="aa00027_html"><div class="ttname"><a href="a00027.html">BMLTServerInteraction</a></div><div class="ttdef"><b>Definition</b> <a href="a00005_source.html#l00045">LGV_MeetingServer_BMLT.php:45</a></div></div>
<div class="ttc" id="aa00031_html"><div class="ttname"><a href="a00031.html">LGV_MeetingServer_PDO</a></div><div class="ttdoc">This class provides a genericized interface to the PHP PDO toolkit.</div><div class="ttdef"><b>Definition</b> <a href="a00008_source.html#l00035">LGV_MeetingServer_PDO.class.php:35</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00011_source.html#l00036">__SERVER_VERSION__</a>.</p>

</div>
</div>
<a id="a68ded32394f22a9d9c6f238c60e5c651" name="a68ded32394f22a9d9c6f238c60e5c651"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68ded32394f22a9d9c6f238c60e5c651">&#9670;&#160;</a></span>query_database()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">query_database </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$geo_center_lng</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$geo_center_lat</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$geo_radius</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$minimum_found</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$weekdays</em> = <code>[]</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$start_time</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$end_time</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$org_key</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$ids</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$type</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$page</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$page_size</em> = <code>-1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>a JSON object, with the meetings found, and the time it took for the search to be done (in seconds). NULL, if no meetings found. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$geo_center_lng</td><td>OPTIONAL FLOAT: The longitude (in degrees) of the center of the search  </td></tr>
    <tr><td class="paramname">$geo_center_lat</td><td>OPTIONAL FLOAT: The latitude (in degrees) of the center of the search  </td></tr>
    <tr><td class="paramname">$geo_radius</td><td>OPTIONAL UNSIGNED FLOAT: The maximum radius (in Kilometers) of the search.  </td></tr>
    <tr><td class="paramname">$minimum_found</td><td>OPTIONAL UNSIGNED INT: If nonzero, then the search will be an "auto-radius" search, starting from the center, and expanding in steps (each step is 1/20 of the total radius). Once this many meetings are found (or the maximum radius is reached), the search stops, and the found metings are returned.  </td></tr>
    <tr><td class="paramname">$weekdays</td><td>OPTIONAL ARRAY[UNSIGNED INT (1 - 7)]: Any weekdays. Each integer is 1-7 (1 is always Sunday). There are a maximum of 7 elements. An empty Array (default), means all weekdays. If any values are present, ONLY those days are found.  </td></tr>
    <tr><td class="paramname">$start_time</td><td>OPTIONAL UNSIGNED INT: A minimum start time, in seconds (0 -&gt; 86400, with 86399 being "One minute before midnight tonight," and 0 being "midnight, this morning"). Default is 0. This is inclusive (25200 is 7AM, or later).  </td></tr>
    <tr><td class="paramname">$end_time</td><td>OPTIONAL UNSIGNED INT: A maximum start time, in seconds (0 -&gt; 86400, with 86399 being "One minute before midnight tonight," and 0 being "midnight, this morning"). Default is 0. This is inclusive (25200 is 7AM, or earlier). This must be greater than $start_time.  </td></tr>
    <tr><td class="paramname">$org_key</td><td>OPTIONAL STRING ARRAY: The key[s] for one or more particular organization[s]. If not provided, all organizations are searched.  </td></tr>
    <tr><td class="paramname">$ids</td><td>OPTIONAL ARRAY[(UNSIGNED INT, UNSIGNED INT)]: This can be an array of tuples (each being a server ID, and a meeting ID, in that order, as integers). These represent individual meetings. If these are provided, then ONLY those meetings will be returned, but any other parameters will still be applied.  </td></tr>
    <tr><td class="paramname">$type</td><td>The type of meeting (physical, virtual, or hybrid). 0 is any meeting (all of the above). 1, is physical (with or without virtual), 2 is physical only, -1 is virtual (with or without physical), -2 is virtual only. Default is 0 (all meetings).  </td></tr>
    <tr><td class="paramname">$page</td><td>OPTIONAL UNSIGNED INTEGER: This is the 0-based page. Default is 0 (from the beginning).  </td></tr>
    <tr><td class="paramname">$page_size</td><td>OPTIONAL INTEGER: The size of each page. 0, means return a count only. Negative values mean the whole search should be returned in one page, and $page is ignored (considered to be 0). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00391">391</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  403</span>                          {</div>
<div class="line"><span class="lineno">  404</span>    set_time_limit(60);    <span class="comment">// Just in case we have time-consuming searches.</span></div>
<div class="line"><span class="lineno">  405</span>    <span class="comment">// Practice good argument hygiene.</span></div>
<div class="line"><span class="lineno">  406</span>    $minimum_found = abs(intval($minimum_found));</div>
<div class="line"><span class="lineno">  407</span>    $start_time = abs(intval($start_time));</div>
<div class="line"><span class="lineno">  408</span>    $page = max(0, intval($page));</div>
<div class="line"><span class="lineno">  409</span>    $page_size = max(-1, intval($page_size));</div>
<div class="line"><span class="lineno">  410</span>    $step_size_in_km = $geo_radius;</div>
<div class="line"><span class="lineno">  411</span>    </div>
<div class="line"><span class="lineno">  412</span>    $initial_time = microtime(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  413</span>    </div>
<div class="line"><span class="lineno">  414</span>    $current_step = $step_size_in_km;</div>
<div class="line"><span class="lineno">  415</span>    </div>
<div class="line"><span class="lineno">  416</span>    $geo_search = NULL != $geo_center_lng &amp;&amp; NULL != $geo_center_lat;</div>
<div class="line"><span class="lineno">  417</span>    </div>
<div class="line"><span class="lineno">  418</span>    $geo_center_lng = floatval($geo_center_lng);</div>
<div class="line"><span class="lineno">  419</span>    $geo_center_lat = floatval($geo_center_lat);</div>
<div class="line"><span class="lineno">  420</span>    $geo_radius = abs(floatval($geo_radius));</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>    <span class="keywordflow">if</span> ( !$geo_search ) {</div>
<div class="line"><span class="lineno">  423</span>        $geo_radius = 0;</div>
<div class="line"><span class="lineno">  424</span>        $minimum_found = 0;</div>
<div class="line"><span class="lineno">  425</span>    }</div>
<div class="line"><span class="lineno">  426</span>    </div>
<div class="line"><span class="lineno">  427</span>    <span class="keywordflow">if</span> ( 0 &lt; $minimum_found &amp;&amp; 0 &lt; $geo_radius &amp;&amp; $geo_search) {</div>
<div class="line"><span class="lineno">  428</span>        $step_size_in_km = 0.5;</div>
<div class="line"><span class="lineno">  429</span>        $current_step = $step_size_in_km;</div>
<div class="line"><span class="lineno">  430</span>    <span class="comment">// Special case for specifying a minimum, without a radius. We set 5Km steps, and a max radius of 10000 Km.</span></div>
<div class="line"><span class="lineno">  431</span>    } elseif ( 0 &lt; $minimum_found &amp;&amp; 0 == $geo_radius &amp;&amp; $geo_search) {</div>
<div class="line"><span class="lineno">  432</span>        $step_size_in_km = 0.5;</div>
<div class="line"><span class="lineno">  433</span>        $current_step = $step_size_in_km;</div>
<div class="line"><span class="lineno">  434</span>        $geo_radius = 10000;</div>
<div class="line"><span class="lineno">  435</span>    }</div>
<div class="line"><span class="lineno">  436</span>    </div>
<div class="line"><span class="lineno">  437</span>    $predicate = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  438</span>    $params = [];</div>
<div class="line"><span class="lineno">  439</span>    </div>
<div class="line"><span class="lineno">  440</span>    <span class="keywordflow">if</span> ( !empty($weekdays) ) {</div>
<div class="line"><span class="lineno">  441</span>        $weekday_predicate_array = [];</div>
<div class="line"><span class="lineno">  442</span>    </div>
<div class="line"><span class="lineno">  443</span>        <span class="keywordflow">foreach</span> ( $weekdays as $weekday ) {</div>
<div class="line"><span class="lineno">  444</span>            $weekday = abs(intval($weekday));</div>
<div class="line"><span class="lineno">  445</span>            <span class="keywordflow">if</span> ( (0 &lt; $weekday) &amp;&amp; (8 &gt; $weekday) ) {</div>
<div class="line"><span class="lineno">  446</span>                $pred = <span class="stringliteral">&quot;`weekday`=$weekday&quot;</span>;</div>
<div class="line"><span class="lineno">  447</span>                <span class="keywordflow">if</span> ( !in_array($pred, $weekday_predicate_array) ) {</div>
<div class="line"><span class="lineno">  448</span>                    array_push($weekday_predicate_array, $pred);</div>
<div class="line"><span class="lineno">  449</span>                }</div>
<div class="line"><span class="lineno">  450</span>            }</div>
<div class="line"><span class="lineno">  451</span>        }</div>
<div class="line"><span class="lineno">  452</span>    </div>
<div class="line"><span class="lineno">  453</span>        <span class="keywordflow">if</span> ( !empty($weekday_predicate_array) ) {</div>
<div class="line"><span class="lineno">  454</span>            $predicate = <span class="stringliteral">&quot;((&quot;</span>.implode(<span class="stringliteral">&quot;) OR (&quot;</span>, $weekday_predicate_array).<span class="stringliteral">&quot;))&quot;</span>;</div>
<div class="line"><span class="lineno">  455</span>        }</div>
<div class="line"><span class="lineno">  456</span>    }</div>
<div class="line"><span class="lineno">  457</span>    </div>
<div class="line"><span class="lineno">  458</span>    $start_time = intval($start_time);</div>
<div class="line"><span class="lineno">  459</span>    </div>
<div class="line"><span class="lineno">  460</span>    <span class="keywordflow">if</span> ( 0 &lt; $start_time &amp;&amp; 86400 &gt; $start_time ) {</div>
<div class="line"><span class="lineno">  461</span>        $hour = intval($start_time / 3600);</div>
<div class="line"><span class="lineno">  462</span>        $minute = ($start_time - ($hour * 3600)) / 60;</div>
<div class="line"><span class="lineno">  463</span>        $second = $start_time - ($hour * 3600) - ($minute * 60);</div>
<div class="line"><span class="lineno">  464</span>        $comp_time = sprintf(<span class="stringliteral">&quot;%02d:%02d:00&quot;</span>, $hour, $minute);</div>
<div class="line"><span class="lineno">  465</span>        <span class="keywordflow">if</span> ( $predicate ) {</div>
<div class="line"><span class="lineno">  466</span>            $predicate = <span class="stringliteral">&quot;($predicate) AND &quot;</span>;</div>
<div class="line"><span class="lineno">  467</span>        }</div>
<div class="line"><span class="lineno">  468</span>        $predicate .= <span class="stringliteral">&quot;(`start_time`&gt;=&#39;$comp_time&#39;)&quot;</span>;</div>
<div class="line"><span class="lineno">  469</span>    }</div>
<div class="line"><span class="lineno">  470</span>    </div>
<div class="line"><span class="lineno">  471</span>    $end_time = intval($end_time);</div>
<div class="line"><span class="lineno">  472</span>    </div>
<div class="line"><span class="lineno">  473</span>    <span class="keywordflow">if</span> ( 0 &lt; $end_time &amp;&amp; $start_time &lt;= $end_time &amp;&amp; 86400 &gt; $end_time ) {</div>
<div class="line"><span class="lineno">  474</span>        $hour = intval($end_time / 3600);</div>
<div class="line"><span class="lineno">  475</span>        $minute = ($end_time - ($hour * 3600)) / 60;</div>
<div class="line"><span class="lineno">  476</span>        $second = $end_time - ($hour * 3600) - ($minute * 60);</div>
<div class="line"><span class="lineno">  477</span>        $comp_time = sprintf(<span class="stringliteral">&quot;%02d:%02d:00&quot;</span>, $hour, $minute);</div>
<div class="line"><span class="lineno">  478</span>        <span class="keywordflow">if</span> ( $predicate ) {</div>
<div class="line"><span class="lineno">  479</span>            $predicate = <span class="stringliteral">&quot;($predicate) AND &quot;</span>;</div>
<div class="line"><span class="lineno">  480</span>        }</div>
<div class="line"><span class="lineno">  481</span>        $predicate .= <span class="stringliteral">&quot;(`start_time`&lt;=&#39;$comp_time&#39;)&quot;</span>;</div>
<div class="line"><span class="lineno">  482</span>    }</div>
<div class="line"><span class="lineno">  483</span>    </div>
<div class="line"><span class="lineno">  484</span>    <span class="keywordflow">if</span> ( !empty($org_key) ) {</div>
<div class="line"><span class="lineno">  485</span>        <span class="keywordflow">if</span> ( $predicate ) {</div>
<div class="line"><span class="lineno">  486</span>            $predicate .= <span class="stringliteral">&quot; AND &quot;</span>;</div>
<div class="line"><span class="lineno">  487</span>        }</div>
<div class="line"><span class="lineno">  488</span>        $params = $org_key;</div>
<div class="line"><span class="lineno">  489</span>        $sql_predicate = array_fill(0, count($org_key), <span class="stringliteral">&quot;(`organization_key`=?)&quot;</span>);</div>
<div class="line"><span class="lineno">  490</span>        <span class="keywordflow">if</span> ( !empty($sql_predicate) ) {</div>
<div class="line"><span class="lineno">  491</span>            $predicate .= <span class="stringliteral">&quot;((&quot;</span>.implode(<span class="stringliteral">&quot;) OR (&quot;</span>, $sql_predicate).<span class="stringliteral">&quot;))&quot;</span>;</div>
<div class="line"><span class="lineno">  492</span>        }</div>
<div class="line"><span class="lineno">  493</span>    }</div>
<div class="line"><span class="lineno">  494</span>    </div>
<div class="line"><span class="lineno">  495</span>    <span class="keywordflow">if</span> ( 0 != $type ) {</div>
<div class="line"><span class="lineno">  496</span>        <span class="keywordflow">if</span> ( $predicate ) {</div>
<div class="line"><span class="lineno">  497</span>            $predicate .= <span class="stringliteral">&quot; AND &quot;</span>;</div>
<div class="line"><span class="lineno">  498</span>        }</div>
<div class="line"><span class="lineno">  499</span>        </div>
<div class="line"><span class="lineno">  500</span>        <span class="keywordflow">switch</span> ($type) {</div>
<div class="line"><span class="lineno">  501</span>            <span class="keywordflow">case</span> -2:</div>
<div class="line"><span class="lineno">  502</span>                $predicate .= <span class="stringliteral">&#39;((`virtual_information` IS NOT NULL) AND (`physical_address` IS NULL))&#39;</span>;</div>
<div class="line"><span class="lineno">  503</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  504</span>            </div>
<div class="line"><span class="lineno">  505</span>            <span class="keywordflow">case</span> -1:</div>
<div class="line"><span class="lineno">  506</span>                $predicate .= <span class="stringliteral">&#39;(`virtual_information` IS NOT NULL)&#39;</span>;</div>
<div class="line"><span class="lineno">  507</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  508</span>            <span class="keywordflow">case</span> 1:</div>
<div class="line"><span class="lineno">  509</span>                $predicate .= <span class="stringliteral">&#39;(`physical_address` IS NOT NULL)&#39;</span>;</div>
<div class="line"><span class="lineno">  510</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  511</span>            </div>
<div class="line"><span class="lineno">  512</span>            <span class="keywordflow">case</span> 2:</div>
<div class="line"><span class="lineno">  513</span>                $predicate .= <span class="stringliteral">&#39;((`virtual_information` IS NULL) AND (`physical_address` IS NOT NULL))&#39;</span>;</div>
<div class="line"><span class="lineno">  514</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  515</span>            </div>
<div class="line"><span class="lineno">  516</span>            <span class="keywordflow">case</span> -3:</div>
<div class="line"><span class="lineno">  517</span>            <span class="keywordflow">case</span> 3:</div>
<div class="line"><span class="lineno">  518</span>                $predicate .= <span class="stringliteral">&#39;((`virtual_information` IS NOT NULL) AND (`physical_address` IS NOT NULL))&#39;</span>;</div>
<div class="line"><span class="lineno">  519</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  520</span>        }</div>
<div class="line"><span class="lineno">  521</span>    }</div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span>    <span class="keywordflow">if</span> ( !empty($ids) ) {</div>
<div class="line"><span class="lineno">  524</span>        $plist = [];</div>
<div class="line"><span class="lineno">  525</span>        <span class="keywordflow">foreach</span> ( $ids as $id ) {</div>
<div class="line"><span class="lineno">  526</span>            <span class="keywordflow">if</span> ( is_array($id) &amp;&amp; (0 &lt; count($id)) ) {</div>
<div class="line"><span class="lineno">  527</span>                $server_id = intval($id[0]);</div>
<div class="line"><span class="lineno">  528</span>                $meeting_id = isset($id[1]) ? intval($id[1]) : 0;</div>
<div class="line"><span class="lineno">  529</span>                <span class="keywordflow">if</span> ( 0 &lt; $server_id ) { <span class="comment">// Need to have at least a server ID.</span></div>
<div class="line"><span class="lineno">  530</span>                    $comp = <span class="stringliteral">&quot;`server_id`=$server_id&quot;</span>;</div>
<div class="line"><span class="lineno">  531</span>                    </div>
<div class="line"><span class="lineno">  532</span>                    <span class="comment">// It is possible to have a server &quot;wildcard&quot; search, where we get every meeting in the server. We do this by specifying no meeting ID, or a non-numeric value (like &quot;*&quot;).</span></div>
<div class="line"><span class="lineno">  533</span>                    <span class="keywordflow">if</span> ( 0 &lt; $meeting_id ) {</div>
<div class="line"><span class="lineno">  534</span>                        $comp .= <span class="stringliteral">&quot; AND `meeting_id`=$meeting_id&quot;</span>;</div>
<div class="line"><span class="lineno">  535</span>                    }</div>
<div class="line"><span class="lineno">  536</span>                    </div>
<div class="line"><span class="lineno">  537</span>                    <span class="keywordflow">if</span> ( !in_array(<span class="stringliteral">&quot;($comp)&quot;</span>, $plist) ) {</div>
<div class="line"><span class="lineno">  538</span>                        array_push($plist, <span class="stringliteral">&quot;($comp)&quot;</span>);</div>
<div class="line"><span class="lineno">  539</span>                    }</div>
<div class="line"><span class="lineno">  540</span>                }</div>
<div class="line"><span class="lineno">  541</span>            }</div>
<div class="line"><span class="lineno">  542</span>        }</div>
<div class="line"><span class="lineno">  543</span>        </div>
<div class="line"><span class="lineno">  544</span>        <span class="keywordflow">if</span> ( !empty($plist) ) {</div>
<div class="line"><span class="lineno">  545</span>            <span class="keywordflow">if</span> ( $predicate ) {</div>
<div class="line"><span class="lineno">  546</span>                $predicate .= <span class="stringliteral">&quot; AND &quot;</span>;</div>
<div class="line"><span class="lineno">  547</span>            }</div>
<div class="line"><span class="lineno">  548</span>            </div>
<div class="line"><span class="lineno">  549</span>            $predicate .= <span class="stringliteral">&quot;(&quot;</span>.implode(<span class="stringliteral">&quot; OR &quot;</span>, $plist).<span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><span class="lineno">  550</span>        }</div>
<div class="line"><span class="lineno">  551</span>    }</div>
<div class="line"><span class="lineno">  552</span>   </div>
<div class="line"><span class="lineno">  553</span>    global $config_file_path;</div>
<div class="line"><span class="lineno">  554</span>    include($config_file_path);    <span class="comment">// Config file path is defined in the calling context. This won&#39;t work, without it.</span></div>
<div class="line"><span class="lineno">  555</span>    $pdo_instance = <span class="keyword">new</span> <a class="code hl_class" href="a00031.html">LGV_MeetingServer_PDO</a>($_dbName, $_dbLogin, $_dbPassword, $_dbType, $_dbHost, $_dbPort);</div>
<div class="line"><span class="lineno">  556</span>    </div>
<div class="line"><span class="lineno">  557</span>    $response = [];</div>
<div class="line"><span class="lineno">  558</span> </div>
<div class="line"><span class="lineno">  559</span>    <span class="keywordflow">if</span> ( <a class="code hl_function" href="a00011.html#a85cc9c49944092a087c82b0124fc93de">_data_table_exists</a>($pdo_instance) ) {</div>
<div class="line"><span class="lineno">  560</span>        <span class="keywordflow">if</span> ( 0 &lt; $minimum_found) {</div>
<div class="line"><span class="lineno">  561</span>            <span class="keywordflow">while</span> ( ($current_step &lt;= $geo_radius) &amp;&amp; ($minimum_found &gt; count($response)) ) {</div>
<div class="line"><span class="lineno">  562</span>                $sql = <a class="code hl_function" href="a00011.html#ab569b03538aff77dcf6be95c31fb0447">_location_predicate</a>($geo_center_lng, $geo_center_lat, $current_step, $predicate, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  563</span>                $response = $pdo_instance-&gt;preparedStatement($sql, $params, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  564</span>                $current_step *= 1.1;</div>
<div class="line"><span class="lineno">  565</span>            }</div>
<div class="line"><span class="lineno">  566</span>       </div>
<div class="line"><span class="lineno">  567</span>            $current_step = min($geo_radius, $current_step);</div>
<div class="line"><span class="lineno">  568</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  569</span>            $sql =  <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  570</span>        </div>
<div class="line"><span class="lineno">  571</span>            <span class="keywordflow">if</span> ( $geo_search ) {</div>
<div class="line"><span class="lineno">  572</span>                $current_step = $geo_radius;</div>
<div class="line"><span class="lineno">  573</span>                $sql = <a class="code hl_function" href="a00011.html#ab569b03538aff77dcf6be95c31fb0447">_location_predicate</a>($geo_center_lng, $geo_center_lat, $geo_radius * 1.05, $predicate, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  574</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  575</span>                $current_step = 0;</div>
<div class="line"><span class="lineno">  576</span>                $sql = <span class="stringliteral">&quot;SELECT * FROM `&quot;</span>.$_dbTableName.<span class="stringliteral">&quot;`&quot;</span>;</div>
<div class="line"><span class="lineno">  577</span>                <span class="keywordflow">if</span> ( !empty($predicate) ) {</div>
<div class="line"><span class="lineno">  578</span>                    $sql .= <span class="stringliteral">&quot; WHERE $predicate&quot;</span>;</div>
<div class="line"><span class="lineno">  579</span>                }</div>
<div class="line"><span class="lineno">  580</span>            </div>
<div class="line"><span class="lineno">  581</span>            }</div>
<div class="line"><span class="lineno">  582</span>            $response = $pdo_instance-&gt;preparedStatement($sql, $params, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  583</span>        }</div>
<div class="line"><span class="lineno">  584</span>    }</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>    <span class="comment">// NOTE ON PAGING: We don&#39;t use SQL to page, because our &quot;cleaning,&quot; with the Vincenty algorithm, could shave off some meetings.</span></div>
<div class="line"><span class="lineno">  587</span>    <span class="comment">// We do avoid a couple of the time-intensive tasks, though, if we are just looking for metrics.</span></div>
<div class="line"><span class="lineno">  588</span>    <span class="comment">// 0 for a page size, means we are just looking for a total count. -1, means we want the whole found set at once.</span></div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>    <span class="keywordflow">if</span> ( !empty($response) &amp;&amp; (!$geo_search || ($current_step == $geo_radius) || ((0 &lt; $minimum_found) &amp;&amp; (count($response) &gt;= $minimum_found))) ) {</div>
<div class="line"><span class="lineno">  591</span>        $ret = Array();</div>
<div class="line"><span class="lineno">  592</span>    </div>
<div class="line"><span class="lineno">  593</span>        <span class="keywordflow">foreach</span> ( $response as $meeting ) {</div>
<div class="line"><span class="lineno">  594</span>            <span class="keywordflow">if</span> ( $geo_search &amp;&amp; isset($meeting[<span class="stringliteral">&quot;latitude&quot;</span>]) &amp;&amp; isset($meeting[<span class="stringliteral">&quot;longitude&quot;</span>]) ) {</div>
<div class="line"><span class="lineno">  595</span>                <span class="comment">// We apply a Vincenty algorithm, to refine the distance. It is more accurate than the simple one we used for the main search.</span></div>
<div class="line"><span class="lineno">  596</span>                $distance = <a class="code hl_function" href="a00011.html#aa708539db35f3694b961934862f9733f">_get_accurate_distance</a>($geo_center_lat, $geo_center_lng, floatVal($meeting[<span class="stringliteral">&quot;latitude&quot;</span>]), floatval($meeting[<span class="stringliteral">&quot;longitude&quot;</span>]));</div>
<div class="line"><span class="lineno">  597</span>                <span class="keywordflow">if</span> ( $geo_radius &gt;= $distance ) {</div>
<div class="line"><span class="lineno">  598</span>                    $meeting[<span class="stringliteral">&quot;distance&quot;</span>] = $distance;</div>
<div class="line"><span class="lineno">  599</span>                    <span class="keywordflow">if</span> ( 0 != $page_size ) {</div>
<div class="line"><span class="lineno">  600</span>                        array_push($ret, <a class="code hl_function" href="a00011.html#a3de322379d94508a881aca245ac6919a">_clean_meeting</a>($meeting));</div>
<div class="line"><span class="lineno">  601</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  602</span>                        array_push($ret, $meeting);</div>
<div class="line"><span class="lineno">  603</span>                    }</div>
<div class="line"><span class="lineno">  604</span>                }</div>
<div class="line"><span class="lineno">  605</span>            } elseif ( 0 != $page_size ) {</div>
<div class="line"><span class="lineno">  606</span>                array_push($ret, <a class="code hl_function" href="a00011.html#a3de322379d94508a881aca245ac6919a">_clean_meeting</a>($meeting));</div>
<div class="line"><span class="lineno">  607</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  608</span>                array_push($ret, $meeting);</div>
<div class="line"><span class="lineno">  609</span>            }</div>
<div class="line"><span class="lineno">  610</span>        }</div>
<div class="line"><span class="lineno">  611</span>        </div>
<div class="line"><span class="lineno">  612</span>        <span class="keywordflow">if</span> ( 0 != $page_size ) {</div>
<div class="line"><span class="lineno">  613</span>            usort($ret, <span class="stringliteral">&quot;_sort_meetings_by_&quot;</span>.($geo_search ? <span class="stringliteral">&quot;distance&quot;</span> : <span class="stringliteral">&quot;id&quot;</span>));</div>
<div class="line"><span class="lineno">  614</span>        }</div>
<div class="line"><span class="lineno">  615</span>        </div>
<div class="line"><span class="lineno">  616</span>        $count = count($ret);</div>
<div class="line"><span class="lineno">  617</span>        $total_pages = intval((0 &gt; $page_size) ? 1 : ((0 == $page_size) ? 0 : (($count + ($page_size - 1)) / $page_size)));</div>
<div class="line"><span class="lineno">  618</span>        </div>
<div class="line"><span class="lineno">  619</span>        $starting_index = max(0, $page * $page_size);</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>        <span class="keywordflow">if</span> ( 0 &gt; $page_size ) {</div>
<div class="line"><span class="lineno">  622</span>            $page_size = $count;</div>
<div class="line"><span class="lineno">  623</span>            $page = 0;</div>
<div class="line"><span class="lineno">  624</span>        }</div>
<div class="line"><span class="lineno">  625</span>        </div>
<div class="line"><span class="lineno">  626</span>        $page_end_index = min($count, ($page + 1) * $page_size);</div>
<div class="line"><span class="lineno">  627</span>        </div>
<div class="line"><span class="lineno">  628</span>        $slice_size = $page_end_index - $starting_index;</div>
<div class="line"><span class="lineno">  629</span>        </div>
<div class="line"><span class="lineno">  630</span>        $json_meetings = <span class="stringliteral">&quot;\&quot;meetings\&quot;: &quot;</span>.json_encode(array_slice($ret, $starting_index, $slice_size));</div>
<div class="line"><span class="lineno">  631</span>        </div>
<div class="line"><span class="lineno">  632</span>        $meta = <span class="stringliteral">&quot;\&quot;meta\&quot;: {\&quot;total\&quot;: $count, \&quot;total_pages\&quot;: $total_pages, \&quot;page_size\&quot;: $page_size, \&quot;page\&quot;: $page, \&quot;starting_index\&quot;: $starting_index, \&quot;actual_size\&quot;: $slice_size, \&quot;search_time\&quot;: &quot;</span>.(microtime(<span class="keyword">true</span>) - $initial_time).($geo_search ? <span class="stringliteral">&quot;, \&quot;center_lat\&quot;: $geo_center_lat, \&quot;center_lng\&quot;: $geo_center_lng, \&quot;radius_in_km\&quot;: $current_step &quot;</span> : <span class="stringliteral">&quot;&quot;</span>).<span class="stringliteral">&quot;}&quot;</span>;</div>
<div class="line"><span class="lineno">  633</span>        </div>
<div class="line"><span class="lineno">  634</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;{&quot;</span>.$meta.<span class="stringliteral">&quot;, &quot;</span>.$json_meetings.<span class="stringliteral">&quot;}&quot;</span>;</div>
<div class="line"><span class="lineno">  635</span>    }</div>
<div class="line"><span class="lineno">  636</span>    </div>
<div class="line"><span class="lineno">  637</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;{ \&quot;meta\&quot;: {\&quot;total\&quot;: 0}, \&quot;meetings\&quot;: []}&quot;</span>;</div>
<div class="line"><span class="lineno">  638</span>}</div>
<div class="ttc" id="aa00011_html_a3de322379d94508a881aca245ac6919a"><div class="ttname"><a href="a00011.html#a3de322379d94508a881aca245ac6919a">_clean_meeting</a></div><div class="ttdeci">_clean_meeting($meeting)</div><div class="ttdef"><b>Definition</b> <a href="a00011_source.html#l00164">LGV_MeetingServer.php:164</a></div></div>
<div class="ttc" id="aa00011_html_a85cc9c49944092a087c82b0124fc93de"><div class="ttname"><a href="a00011.html#a85cc9c49944092a087c82b0124fc93de">_data_table_exists</a></div><div class="ttdeci">_data_table_exists($pdo_instance)</div><div class="ttdef"><b>Definition</b> <a href="a00011_source.html#l00293">LGV_MeetingServer.php:293</a></div></div>
<div class="ttc" id="aa00011_html_aa708539db35f3694b961934862f9733f"><div class="ttname"><a href="a00011.html#aa708539db35f3694b961934862f9733f">_get_accurate_distance</a></div><div class="ttdeci">_get_accurate_distance( $lat1, $lon1, $lat2, $lon2)</div><div class="ttdoc">Uses the Vincenty calculation to determine the distance (in Kilometers) between the two given lat/lon...</div><div class="ttdef"><b>Definition</b> <a href="a00011_source.html#l00049">LGV_MeetingServer.php:49</a></div></div>
<div class="ttc" id="aa00011_html_ab569b03538aff77dcf6be95c31fb0447"><div class="ttname"><a href="a00011.html#ab569b03538aff77dcf6be95c31fb0447">_location_predicate</a></div><div class="ttdeci">_location_predicate( $geo_center_lng, $geo_center_lat, $geo_radius, $predicate=&quot;&quot;, $count_only=false)</div><div class="ttdef"><b>Definition</b> <a href="a00011_source.html#l00231">LGV_MeetingServer.php:231</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00011_source.html#l00164">_clean_meeting()</a>, <a class="el" href="a00011_source.html#l00293">_data_table_exists()</a>, <a class="el" href="a00011_source.html#l00049">_get_accurate_distance()</a>, and <a class="el" href="a00011_source.html#l00231">_location_predicate()</a>.</p>

</div>
</div>
<a id="a469d06d76d28a0ffb60101f09ee5d9a4" name="a469d06d76d28a0ffb60101f09ee5d9a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a469d06d76d28a0ffb60101f09ee5d9a4">&#9670;&#160;</a></span>update_database()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">update_database </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$physical_only</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$force</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$separate_virtual</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This actually fetches all the meetings, converts them to our local format, and stores them into a temporary table. Once that is done, it deletes the current data table, and replaces it with the newly initialized temp table.</p>
<p>This checks to see if the meta table exists. If it does not, then it creates it. This checks if the data table exists. If it does, and if the elapsed time has passed, an update is forced. Otherwise, if it does not exist, an update is forced (which creates it).</p>
<dl class="section return"><dt>Returns</dt><dd>: the number of meetings updated. NULL, if no update. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$physical_only</td><td>OPTIONAL BOOLEAN: If true (default is false), then only meetings that have a physical location will be stored.  </td></tr>
    <tr><td class="paramname">$force</td><td>OPTIONAL BOOLEAN: If true (default is false), then the update occurs, even if not otherwise prescribed.  </td></tr>
    <tr><td class="paramname">$separate_virtual</td><td>OPTIONAL BOOLEAN: If true (default is false), then virtual-only meetings will be counted, but will be assigned a "virtual-%s" (with "%s" being the org key) org key. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00356">356</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  359</span>                          {</div>
<div class="line"><span class="lineno">  360</span>    set_time_limit(3600);    <span class="comment">// We give ourselves a ridiculous amount of time, as this may take a while.</span></div>
<div class="line"><span class="lineno">  361</span>    </div>
<div class="line"><span class="lineno">  362</span>    $bmltClass = <span class="keyword">new</span> <a class="code hl_class" href="a00027.html">BMLTServerInteraction</a>();</div>
<div class="line"><span class="lineno">  363</span>    </div>
<div class="line"><span class="lineno">  364</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  365</span>        global $config_file_path;</div>
<div class="line"><span class="lineno">  366</span>        include($config_file_path);    <span class="comment">// Config file path is defined in the calling context. This won&#39;t work, without it.</span></div>
<div class="line"><span class="lineno">  367</span>        $pdo_instance = <span class="keyword">new</span> <a class="code hl_class" href="a00031.html">LGV_MeetingServer_PDO</a>($_dbName, $_dbLogin, $_dbPassword, $_dbType, $_dbHost, $_dbPort);</div>
<div class="line"><span class="lineno">  368</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="a00011.html#a00e7763e4a4054855e7b26ed1a1b6b3f">_meta_table_exists</a>($pdo_instance) ) {</div>
<div class="line"><span class="lineno">  369</span>            <a class="code hl_function" href="a00011.html#a899d62edf15238d8b1ee326064fb2871">_initialize_meta_database</a>($pdo_instance);</div>
<div class="line"><span class="lineno">  370</span>        }</div>
<div class="line"><span class="lineno">  371</span>        $lastupdate_response = $pdo_instance-&gt;preparedStatement(<span class="stringliteral">&quot;SELECT `last_update` FROM `$_dbMetaTableName`&quot;</span>, [], <span class="keyword">true</span>)[0][<span class="stringliteral">&quot;last_update&quot;</span>];</div>
<div class="line"><span class="lineno">  372</span>        $lapsed_time = time() - intval($lastupdate_response);</div>
<div class="line"><span class="lineno">  373</span>        <span class="keywordflow">if</span> ( (!<a class="code hl_function" href="a00011.html#a85cc9c49944092a087c82b0124fc93de">_data_table_exists</a>($pdo_instance) || $force || ($_updateIntervalInSeconds &lt; $lapsed_time)) &amp;&amp; <a class="code hl_function" href="a00011.html#a4f0682a1c6673c26c33a7c5669d256b5">_initialize_main_database</a>($pdo_instance, $_dbTempTableName) ) {</div>
<div class="line"><span class="lineno">  374</span>            $number_of_meetings = $bmltClass-&gt;process_all_meetings($pdo_instance, $_dbTempTableName, $physical_only, $separate_virtual);</div>
<div class="line"><span class="lineno">  375</span>            <span class="keywordflow">if</span> ( 0 &lt; $number_of_meetings ) {</div>
<div class="line"><span class="lineno">  376</span>                $rename_sql = <span class="stringliteral">&quot;DROP TABLE IF EXISTS `$_dbTableName`;RENAME TABLE `$_dbTempTableName` TO `$_dbTableName`;UPDATE `$_dbMetaTableName` SET `last_update`=? WHERE 1;&quot;</span>;</div>
<div class="line"><span class="lineno">  377</span>                $pdo_instance-&gt;preparedStatement($rename_sql, [time()]);</div>
<div class="line"><span class="lineno">  378</span>                <span class="keywordflow">return</span> $number_of_meetings;</div>
<div class="line"><span class="lineno">  379</span>            }</div>
<div class="line"><span class="lineno">  380</span>        }</div>
<div class="line"><span class="lineno">  381</span>    } <span class="keywordflow">catch</span> (Exception $exception) {</div>
<div class="line"><span class="lineno">  382</span>    }</div>
<div class="line"><span class="lineno">  383</span>   </div>
<div class="line"><span class="lineno">  384</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  385</span>}</div>
<div class="ttc" id="aa00011_html_a00e7763e4a4054855e7b26ed1a1b6b3f"><div class="ttname"><a href="a00011.html#a00e7763e4a4054855e7b26ed1a1b6b3f">_meta_table_exists</a></div><div class="ttdeci">_meta_table_exists($pdo_instance)</div><div class="ttdef"><b>Definition</b> <a href="a00011_source.html#l00277">LGV_MeetingServer.php:277</a></div></div>
<div class="ttc" id="aa00011_html_a4f0682a1c6673c26c33a7c5669d256b5"><div class="ttname"><a href="a00011.html#a4f0682a1c6673c26c33a7c5669d256b5">_initialize_main_database</a></div><div class="ttdeci">_initialize_main_database( $pdo_instance, $dbTableName)</div><div class="ttdef"><b>Definition</b> <a href="a00011_source.html#l00329">LGV_MeetingServer.php:329</a></div></div>
<div class="ttc" id="aa00011_html_a899d62edf15238d8b1ee326064fb2871"><div class="ttname"><a href="a00011.html#a899d62edf15238d8b1ee326064fb2871">_initialize_meta_database</a></div><div class="ttdeci">_initialize_meta_database( $pdo_instance)</div><div class="ttdef"><b>Definition</b> <a href="a00011_source.html#l00309">LGV_MeetingServer.php:309</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00011_source.html#l00293">_data_table_exists()</a>, <a class="el" href="a00011_source.html#l00329">_initialize_main_database()</a>, <a class="el" href="a00011_source.html#l00309">_initialize_meta_database()</a>, and <a class="el" href="a00011_source.html#l00277">_meta_table_exists()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a95513464f33ecdb6bd6b6414591f8157" name="a95513464f33ecdb6bd6b6414591f8157"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95513464f33ecdb6bd6b6414591f8157">&#9670;&#160;</a></span>__SERVER_VERSION__</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const __SERVER_VERSION__ &quot;1.4.0&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00036">36</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>

<p class="reference">Referenced by <a class="el" href="a00011_source.html#l00644">get_server_info()</a>.</p>

</div>
</div>
<a id="af0c7f28ccc4d9e483f17007aff10b070" name="af0c7f28ccc4d9e483f17007aff10b070"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0c7f28ccc4d9e483f17007aff10b070">&#9670;&#160;</a></span>defined</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">defined( 'LGV_DB_CATCHER') or define( 'LGV_DB_CATCHER' </td>
          <td>(</td>
          <td class="paramtype">'LGV_DB_CATCHER'&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00011_source.html#l00032">32</a> of file <a class="el" href="a00011_source.html">LGV_MeetingServer.php</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_937900b87e0c7a5fa01190c395fb83f7.html">Sources</a></li><li class="navelem"><a class="el" href="a00011.html">LGV_MeetingServer.php</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
